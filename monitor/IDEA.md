# Monitor

> 机房信息监测脚本

## 初步构思

前几日机房空调坏了，机器全部过热暂停，过了一段时间才被发现。

想利用Go语言写个脚本，运行在工控机上，定期采集局域网内某些指定IP的硬件信息或者利用其他方式检查服务器是否Live，当无法访问时发送邮件到管理员邮箱。

~~拟采用C/S模式。~~

### ~~monitor-server~~

> 部署在公网/工控机

- 运行go语言程序，监听本地8888端口
- 当收到第一条post消息时，程序激活；
- 若在一个时段内收到client端的post消息，则将计数器+1
- 若连续三个时段计数器值为0，则向admin用户发送一封示警邮件；
- 发送邮件后程序静默，等待下一个有效post消息将其激活；

### ~~monitor-client~~

> 部署在机房某闲置节点（不会过热死机）

- 获取IP列表内服务器的状态，考虑到有部分服务器底层做了虚拟化处理，只用ping或端口扫描；
- 将信息暂存，http post发送给server端；



直接用一个Go程序实现更简单，可以多部署几个。

### monitor-go

> 部署在机房闲置节点/工控机（不会过热死机）

- 每天定时邮件发送一次服务器状态；
- 每30分钟检测一次局域网内服务器状态，连续三次没有监测到所有节点就发送邮件给admin；
- **能主动查询；**



#### 需要考虑：

两张表：day.log、hour.log

断网如何处理

开机自启动

程序静默，不要频繁发送消息
